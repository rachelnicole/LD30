<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>hello phaser!</title>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script type="text/javascript" src="js/phaser.js"></script>

        <link type="text/css" rel="stylesheet" href="css/style.css">
  
      <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18888172-1']);
  _gaq.push(['_trackPageview']);

  (function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>
    </head>
    <body>
    <div id="caged">
    </div>
    <div id="andy">
    </div>

    <script type="text/javascript">

    var game = new Phaser.Game(700, 700, Phaser.AUTO, 'phaser', { preload: preload, create: create, update: update });

    function preload() {

      game.load.image('background', 'assets/background.png');
      game.load.image('p1', 'assets/p1.png');
      game.load.image('p2', 'assets/p2.png');
      game.load.image('blackhole', 'assets/blackhole.png');

      game.time.advancedTiming = true;

    }

    var sprite;

    var upKey;
    var downKey;
    var leftKey;
    var rightKey;

    function create() {

      game.add.sprite(0, 0, 'background');

      p2 = game.add.sprite(5, 5, 'p1');

      p1 = game.add.sprite(675, 675, 'p2'); 

      blackhole = game.add.sprite(game.world.centerX, game.world.centerY, 'blackhole');

      blackhole.x = game.world.centerX;
      blackhole.y = game.world.centerY;

      blackhole.anchor.setTo(0.5, 0.5);


      game.physics.enable(p1, Phaser.Physics.ARCADE);
      game.physics.enable(p2, Phaser.Physics.ARCADE);
      game.physics.enable(blackhole, Phaser.Physics.ARCADE);

      p1.body.collideWorldBounds = true;
      p2.body.collideWorldBounds = true;

      p1.body.height = 19;
      p1.body.width = 19;

      p2.body.height = 19;
      p2.body.width = 19;

      blackhole.body.height = 123;
      blackhole.body.width = 123;
      blackhole.body.radius = 61;

      
    

      upKey = game.input.keyboard.addKey(Phaser.Keyboard.UP);
      downKey = game.input.keyboard.addKey(Phaser.Keyboard.DOWN);
      leftKey = game.input.keyboard.addKey(Phaser.Keyboard.LEFT);
      rightKey = game.input.keyboard.addKey(Phaser.Keyboard.RIGHT);

      upKey2 = game.input.keyboard.addKey(Phaser.Keyboard.W);
      downKey2 = game.input.keyboard.addKey(Phaser.Keyboard.S);
      leftKey2 = game.input.keyboard.addKey(Phaser.Keyboard.A);
      rightKey2 = game.input.keyboard.addKey(Phaser.Keyboard.D);

      game.physics.startSystem(Phaser.Physics.P2JS);    
      game.physics.p2.enable(this.square);

    }

    function update() {

      blackhole.angle++;
      // this.square2.angle--;

      blackhole.scale.setTo(Math.sin(game.time.now * 0.001) + 2);
      // this.square2.scale.setTo(Math.sin(game.time.now * 0.001) + 2);

      if (upKey.isDown)
      {
          p1.y--;
      }
      else if (downKey.isDown)
      {
          p1.y++;
      }

      if (leftKey.isDown)
      {
          p1.x--;
      }
      else if (rightKey.isDown)
      {
          p1.x++;
      }

      if (upKey2.isDown)
      {
          p2.y--;
      }
      else if (downKey2.isDown)
      {
          p2.y++;
      }

      if (leftKey2.isDown)
      {
          p2.x--;
      }
      else if (rightKey2.isDown)
      {
          p2.x++;
      }


      game.physics.arcade.overlap(p1, p2, doStuffGood);
      game.physics.arcade.overlap(p1, blackhole, doStuffBad);
      game.physics.arcade.overlap(p2, blackhole, doStuffBad);

    }

    function doStuffBad() {
      $('#caged').css('display', 'block');
    }

    function doStuffGood() {
      $('#andy').css('display', 'block');
    }




   

    </script>

    <div id="hey-listen">
      Use WASD to control top left, use  ↑ ↓ ← → for bottom right.<br>
      don't touch the spiky thing. you want the two circles to touch.
    </div>

    </body>
</html>